#' PMV based on Adaptive Thermal Heat Balance Framework for Model 4
#' 
#' aliases athb ATHB
#' @description \code{calcATHBpmvModel4} calculates the PMV based on adaptive thermal heat balance framework 
#' @description based on the newest version (2022)
#' 
#' @usage calcATHBpmvModel4(trm, ta, tr, vel, rh, met, coolingStrategyBuilding)
#'
#' @param trm - Running mean outdoor temperature in [degree C]
#' @param ta - a numeric value presenting air temperature in [degree C]
#' @param tr - a numeric value presenting mean radiant temperature in [degree C]
#' @param vel - a numeric value presenting air velocity in [m/s]
#' @param rh - a numeric value presenting relative humidity [\%]
#' @param met - a numeric value presenting metabolic rate in [met]
#' @param coolingStrategyBuilding - the process in which the building was 
#' ventilated. Value can be among Mixed Mode','Naturally Ventilated' as a String
#'
#' @return \code{calcATHBpmvModel4} PMV value adapted through the ATHB approach with model 4
#'
#' @references 
#' Schweiker & Wagner (2015) <doi:10.1016/j.buildenv.2015.08.018>
#' Schweiker (2022) <doi:10.1111/ina.13018>
#' 
#' @author Code implemented in to R by Shaomi Rahman. Further contribution by Marcel Schweiker.
#' @seealso see also \code{\link{calcComfInd}}, \code{link{calcATHBpts}}, \code{link{calcATHBset}},
#' @seealso \code{link{calcATHBpmv2015}}
#' @export
#'
#' @examples calcATHBpmvModel4(20, 25, 25, .1, 50, 1.1, 'Mixed Mode')

calcATHBpmvModel4 <- function(trm, ta, tr, vel, rh, met, coolingStrategyBuilding){
  
  coolingStrategyBuildingValues <- calcCoolingStrategyBuilding(coolingStrategyBuilding)
  mixedMode <- coolingStrategyBuildingValues[1]
  naturallyVentilated <- coolingStrategyBuildingValues[2]
  
  # metabolic rate through physiological adaptation
  metAdpt <- met - (0.234 * trm) / 58.2
  
  # adapted clothing insulation level through behavioural adaptation
  cloAdpt <- 10 ^ (0.0678709 - 0.0108181 * trm - 0.1405266 * metAdpt - 
                   0.584214 * mixedMode - 0.1481348 * naturallyVentilated + 
                   0.006570719 * trm * metAdpt + 0.02967495 * trm * mixedMode
                   - 0.001120562 * trm * naturallyVentilated + 0.5218298 * 
                   metAdpt * mixedMode + 0.176447 * metAdpt * naturallyVentilated
                    - 0.02880285 * trm * metAdpt * mixedMode - 0.004975665 * trm
                   * metAdpt * naturallyVentilated)
  
  # adapted thermal load according to Fangerâ€™s PMV mode
  LAdpt <- calcPMVPPD(ta, tr, vel, rh, cloAdpt, metAdpt, getLoad = TRUE)$Lraw
  
  # predicted thermal sensation vote 
  PTSVATHBpmv <- 5.538002 + 0.02399699 * LAdpt - 1.007901 * metAdpt - 0.03647851 *
                 trm + 0.002971073 * LAdpt * metAdpt + 0.0003799504 * LAdpt * trm
                 + 0.02072912 * metAdpt * trm - 0.0004195854 * LAdpt * trm
  PTSVATHBpmv
}
